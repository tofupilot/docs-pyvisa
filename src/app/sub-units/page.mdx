export const metadata = {
  title: 'Sub-units',
  description:
    "This guide explains how to use TofuPilot's sub-units feature to ensure traceability of tests and serial numbers throughout the assembly process.",
}

# Sub-units

Most hardware products are made of multiple components, tested individually and at each step of assembly to the final product. TofuPilot's sub-unit features enable automatic test traceability through the entire process. {{ className: 'lead' }}

This guide explains how to use TofuPilot's sub-units feature to automatically ensure the traceability of tests and serial numbers throughout the assembly process.

<Note>
  This guide details the process of marking units as sub-units when creating a
  test run for a given unit. If you need to set sub-units without creating a
  test run, refer to the [API Reference](/api#update-unit).
</Note>

## Test Strategy

### Introduction

A good industrial test strategy relies on several key steps:

- **Early Test Deployment**: Install tests early at the supplier or assembler, matching each assembly stage.
- **Automated Tests**: Prioritize automation to reduce errors and save time.
- **Standardization and Log Collection**: Standardize logs and systematically collect results.

### Flowchart Example

A test flowchart can be created to provide the manufacturing test team with an overview of the product's testbenches.

<Image src="/test-flowchart.png" alt="Example Test Flowchart" />

In this example of a smart-battery testing strategy:

- **PCBA**: a firmware flash and test is performed at the supplier to verify the integrated components (gauge, LEDs...).
- **Chemical Cells**: a test is performed on the battery cells to check voltage levels.
- **Thermal Probes**: no tests are performed for thermal probes that are purchased off-the-shelf.
- **Smart Battery Assembly**: a test is performed after final assembly to ensure proper integration of all components.

### Flowchart Template

Use our Figma template to quickly create a test flowchart for your product.

<div className="not-prose">
  <Button
    href="https://www.figma.com/community/file/1380891711622677799"
    variant="text"
    arrow="right"
  >
    Get our free test flowchart template
  </Button>
</div>

## Example

To add sub-units in an assembly test, use the `sub_units` parameter to mark certain units as sub-units of test unit.

<CodeGroup label='create_run_with_sub_units.py'>

```python {{ title: 'Pytest plugin'}}
from tofupilot import conf

conf.set(
    procedure_id="FVT3",
    serial_number="BAT01-0001",
    part_number="BAT01",
)

def test_sub_units():
    # Listing example sub_units
    sub_units = [
        {"serial_number": "PCBA01-0001"},
        {"serial_number": "CELL01-0001"},
        {"serial_number": "CELL01-0002"},
        {"serial_number": "CELL01-0003"},
    ]

    # Setting the sub_units in the test configuration
    conf.set(sub_units=sub_units)

    # Rest of your test here...
    assert True
```

```python {{ title: 'Python client'}}
from tofupilot import TofuPilotClient

client = TofuPilotClient()

client.create_run(
    procedure_id="FVT3",
    unit_under_test={
      "serial_number": "BAT01-0001",
      "part_number": "BAT01"
    },
    run_passed=True,
    sub_units=[
      {"serial_number": "PCBA01-0001"},
      {"serial_number": "CELL01-0001"},
      {"serial_number": "CELL01-0002"},
      {"serial_number": "CELL01-0003"}
    ]
)
```

</CodeGroup>

## Unit Pages

The battery assembly was created with its sub-units automatically listed as children in the unit list. You can see and navigate to these sub-units using the expansion menu on the left.

<Image src="/units-with-sub-units.png" alt="Your profile page" />

On the specific battery assembly page, the **Sub-units** section allows you to view and navigate to their individual pages.

<Image src="/unit-with-sub-units.png" alt="Your profile page" />
