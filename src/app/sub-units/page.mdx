export const metadata = {
  title: 'Sub-Units',
  description:
    'TofuPilot offers a fine-tuned Python library to make your life easier and give you the best experience when consuming the API.',
}

# Sub-Units

Most hardware products are made of multiple components, tested individually and at each step of assembly to the final product. TofuPilot's sub-unit features enable automatic test traceability through the entire process. {{ className: 'lead' }}

This guide explains how to use TofuPilot's sub-units feature to automatically ensure the traceability of tests and serial numbers throughout the assembly process.

## Test Strategy

### Introduction

A good industrial test strategy relies on several key steps:

- **Early Test Deployment**: Install tests early at the supplier or assembler, matching each assembly stage.
- **Automated Tests**: Prioritize automation to reduce errors and save time.
- **Standardization and Log Collection**: Standardize logs and systematically collect results.

### Flowchart Example

A test flowchart is very useful to give the production team an overview of the test benches for a product.

<Image src="/test-flowchart.png" alt="Example Test Flowchart" />

In this example of a smart-battery testing strategy:

- **PCBA**: a firmware flash and test is performed at the supplier to verify the integrated components (temperature sensors, LEDs, buttons).
- **Chemical Cells**: a test is performed on the battery cells to check voltage levels.
- **Thermal Probes**: no tests are performed for thermal probes that are purchased off-the-shelf.
- **Smart Battery Assembly**: a complete test is performed after final assembly to ensure proper integration of all components.

### Flowchart Template

Use our Figma template to quickly create a test flowchart for your product.

<div className="not-prose">
  <Button
    href="https://www.figma.com/board/0Esmk43Ct5VKUea3w8QFW0/TofuPilot-%E2%80%BA-Hardware-Testing-Flowchart-Example-(Community)?node-id=0-1&t=Ao7EGHWKaCWnGJK7-0"
    variant="text"
    arrow="right"
  >
    Get our free test flowchart template
  </Button>
</div>

## Example

Here's how to create a Run with sub-units:

```python {{ title: 'create_run_sub_unit.py'}}
from tofupilot import TofuPilotClient

client = TofuPilotClient(api_key="Your API key goes here")

def test_function():
    # your test execution goes here
    # multiple test sub-units
    return True

run_passed = test_function()

client.create_run(
    procedure_id="FVT1",
    unit_under_test={
      "serial_number": "00002",
      "part_number": "SI001"
    },
    run_passed=run_passed,
    sub_units=[{"serial_number": "00102"}]
)
```

<Note>
  Sub-units must be created first; new ones are added without replacing existing
  ones, and duplicates are ignored.
</Note>

## Unit Page

You can now navigate to the Units page to see the hierarchy applied. Use the expand button to view the children of the tested units.

<Image src="/sub-units.png" alt="Your profile page" />
Here's how to create a Run with multiple sub-units:

```python {{ title: 'create_run_sub_units.py'}}
from tofupilot import TofuPilotClient
import time

client = TofuPilotClient(api_key="Your API key goes here")

def test_function():
    # your test execution goes here
    return True

run_passed = test_function()

client.create_run(
    procedure_id="FVT1",
    unit_under_test={
      "serial_number": "00003",
      "part_number": "SI002"
    },
    run_passed=run_passed,
    sub_units=[{"serial_number": "00002"}, {"serial_number": "00102"}]
)
```
