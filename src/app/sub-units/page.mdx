export const metadata = {
  title: 'Sub-units',
  description: 'This guide explains how to use TofuPilot\'s sub-units feature to ensure traceability of tests and serial numbers throughout the assembly process.',
}

# Sub-units

Most hardware products are made of multiple components, tested individually and at each step of assembly to the final product. TofuPilot's sub-unit features enable automatic test traceability through the entire process. {{ className: 'lead' }}

This guide explains how to use TofuPilot's sub-units feature to automatically ensure the traceability of tests and serial numbers throughout the assembly process.

## Test Strategy

### Introduction

A good industrial test strategy relies on several key steps:

- **Early Test Deployment**: Install tests early at the supplier or assembler, matching each assembly stage.
- **Automated Tests**: Prioritize automation to reduce errors and save time.
- **Standardization and Log Collection**: Standardize logs and systematically collect results.

### Flowchart Example

A test flowchart can be created to provide the manufacturing test team with an overview of the product's testbenches.

<Image src="/test-flowchart.png" alt="Example Test Flowchart" />

In this example of a smart-battery testing strategy:

- **PCBA**: a firmware flash and test is performed at the supplier to verify the integrated components (gauge, LEDs...).
- **Chemical Cells**: a test is performed on the battery cells to check voltage levels.
- **Thermal Probes**: no tests are performed for thermal probes that are purchased off-the-shelf.
- **Smart Battery Assembly**: a test is performed after final assembly to ensure proper integration of all components.

### Flowchart Template

Use our Figma template to quickly create a test flowchart for your product.

<div className="not-prose">
  <Button
    href="https://www.figma.com/community/file/1380891711622677799"
    variant="text"
    arrow="right"
  >
    Get our free test flowchart template
  </Button>
</div>

## Example

To add sub-units in an assembly test, specify their serial number in the `sub-units` parameter in `create-run`.

```python {{ title: 'create_run_with_sub_units.py'}}
from tofupilot import TofuPilotClient

client = TofuPilotClient()

def test_function():
    # your test execution goes here
    return True

run_passed = test_function()

client.create_run(
    procedure_id="FVT3",
    unit_under_test={
      "serial_number": "BAT01-0001",
      "part_number": "BAT01"
    },
    run_passed=run_passed,
    sub_units=[
      {"serial_number": "PCBA01-0001"},
      {"serial_number": "CELL01-0001"},
      {"serial_number": "CELL01-0002"},
      {"serial_number": "CELL01-0003"}
    ]
)
```

## Unit Pages

The battery assembly was created with its sub-units automatically listed as children in the unit list. You can see and navigate to these sub-units using the expansion menu on the left.

<Image src="/units-with-sub-units.png" alt="Your profile page" />

On the specific battery assembly page, the **Sub-units** section allows you to view and navigate to their individual pages.

<Image src="/unit-with-sub-units.png" alt="Your profile page" />


## Sub-units

You can track tests throughout assembly with TofuPilot's sub-unit feature. Just specify the serial number of an already tested unit, and it will be marked as a sub-unit of the current one. If a part is retested in a new UUT, it automatically changes parent.

```python {{ title: 'main.py' }}
from openhtf import Test, PhaseResult
import tofupilot

def get_units(test):
    test.test_record.dut_id = 'SI051AB7B0001' # UUT
    test.test_record.sub_units = [            # Sub-units
      'SI051AB7B0001',
      'SI051AB7B0001'
    ]
    return PhaseResult.CONTINUE

def main():
    test = Test(get_unit_info)
    test.add_output_callbacks(tofupilot.synch())
    test.execute()

if **name** == '**main**':
    main()
```

Dedicated [API functions](https://docs.tofupilot.com/a-page) are available to manage sub-units outside of tests. All unit activity is shown on their TofuPilot page.

<Image
  src="/UUT-page-unit-activity.png"
  alt="Activity page for a Unit Under Test (UUT) showing sub-units and test history in TofuPilot."
/>

Most hardware products are made of multiple components, tested individually and at each step of assembly to the final product. TofuPilot's sub-unit features enable automatic test traceability through the entire process. {{ className: 'lead' }}

This guide explains how to use TofuPilot's sub-units feature to automatically ensure the traceability of tests and serial numbers throughout the assembly process.

<Note>
  This guide details the process of marking units as sub-units when creating a
  test run for a given unit. If you need to set sub-units without creating a
  test run, refer to the [API Reference](/api#update-unit).
</Note>
