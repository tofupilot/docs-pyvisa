export const metadata = {
  title: 'Runs API Reference',
  description:
    'On this page, we’ll dive into the different run endpoints you can use to manage runs programmatically.',
}

# Runs

Runs are an essential part of TofuPilot — they are the the primary method for systematically testing and evaluating hardware performance and reliability. On this page, we’ll dive into the different run endpoints you can use to manage runs programmatically. {{ className: 'lead' }}

---

## Create a run {{ tag: 'POST', label: '/v1/runs' }}

<Row>
  <Col>

    This endpoint allows you to register a new run based on a procedure and performed on a unit.

    ## Required attributes

    <Properties>
      <Property name="procedure_id" type="string">
        Unique identifier for the run's procedure.
      </Property>
      <Property name="unit_under_test" type="record">
        - serial_number (string): The serial number of the unit. A new unit will be created if no existing unit is found with this serial number.
        - part_number (optional, string): The part number of the unit's component. A new component will be created if no component with this part number is found. This field is optional if the given serial number corresponds to an already existing unit.
        - revision (optional, string): The revision of the unit's component. This field is required if the unit does not exist and the component has multiple revisions.
      </Property>
      <Property name="run_passed" type="boolean">
        Boolean indicating whether the run passed or not.
      </Property>
    </Properties>

    ## Optional attributes

    <Properties>
      <Property name="duration" type="string / timedelta">
        ISO 8601 duration string or datetime.timedelta (for Python client) indicating the duration of the run.
      </Property>
      <Property name="steps" type="array(record)">
        - name (string): The name of the step.
        - started_at (string): An ISO 8601 formatted timestamp indicating the start time of the step.
        - duration (string): An ISO 8601 duration string indicating the duration of the step.
        - passed (boolean): A boolean indicating whether the step passed or failed.
        - measured_value (optional, float): The value measured during the step execution.
        - unit (optional, string): The unit in which the measured value was measured.
        - min_threshold (optional, float): The minimum acceptable threshold for the step value.
        - max_threshold (optional, float): The maximum acceptable threshold for the step value.
      </Property>
      <Property name="attachments" type="array(string)">
        A list of absolute file paths that should be added as run's attachments.
      </Property>
      <Property name="sub_units" type="array(record)">
        A list of unit identifiers that should be added as sub-units of the run's unit
        - serial_number (string): Serial number of the sub-unit
      </Property>
      <Property name="report_variables" type="record(string, string)">
        {"A dictionary of key/value pairs used to replace {{report variables}} in the procedure's document."}
      </Property>
    </Properties>

  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/runs">

```python
from tofupilot import TofuPilotClient
import time
from datetime import datetime

def test_function():
    # Your test execution goes here
    time.sleep(1)

    run_passed = True
    report_variables = {
      "initial_temperature_reading": "72°C",
      "final_temperature_reading": "75°C",
    }
    attachments = [
      '/mnt/data/temperature-map.png',
      '/mnt/data/performance-report.pdf'
    ]

    return run_passed, report_variables, attachments

# Measure the duration of the test_function
start_time = datetime.now()
run_passed, report_variables, attachments = test_function()
end_time = datetime.now()
duration = end_time - start_time

client = TofuPilotClient(api_key="Your API key goes here")

client.create_run(
    procedure_id="FVT1",
    unit_under_test={
        "serial_number": '00102',
        "part_number": 'PCB01'
    },
    run_passed=run_passed,
    duration=duration,
    report_variables=report_variables,
    attachments=attachments
)
```

```bash {{ title: 'cURL' }}
curl -X POST https://www.tofupilot.com/api/v1/runs
  -H "Content-Type: application/json"
  -H "Authorization: Bearer {your_api_key}"
  -d '{
    "procedure_id": "FVT1",
    "unit_under_test": {
      "serial_number": "00102",
      "part_number": "PCB01"
    },
    "run_passed": true,
    "duration": "PT27M15S"
}'
```

```js
fetch('https://www.tofupilot.com/api/v1/runs', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: 'Bearer "your_api_key"',
  },
  body: JSON.stringify({
    procedure_id: 'FVT1',
    unit_under_test: {
      serial_number: '00102',
      part_number: 'PCB01',
    },
    run_passed: true,
    duration: 'PT27M15S',
  }),
})
```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "url": "https://tofupilot.com/acme-corp/runs/your-new-run"
    }
    ```

  </Col>
</Row>
