export const metadata = {
  title: 'Runs API Reference',
  description:
    "Explore the different run endpoints available in TofuPilot's REST API to manage test runs programmatically.",
}

# REST API Reference

The TofuPilot REST API is the primary interface for programmatically uploading test runs to TofuPilot. {{ className: 'lead' }}

---

## Authentication

Authenticate your requests to access any endpoints in the TofuPilot API using OAuth2 with your API key.

<div className="not-prose mt-8">
  <Button href="/user-management#api-key" variant="text" arrow="right">
    Create your API key
  </Button>
</div>

Add the key to the request header using cURL:

```bash
curl https://tofupilot.com/v1/runs/create \
  -H "Authorization: Bearer {api-key}"
```

Keep your API key safe and [regenerate](/user-management#api-key) it if you suspect compromise.

---

## Create a run {{ tag: 'POST', label: '/v1/runs' }}

<Row>
  <Col>
    This endpoint allows you to create a new run.
    <Properties>
      <Property name="procedure_id" type="string, required">
        Unique identifier for the procedure.
      </Property>
      <Property name="unit_under_test" type="record, required">
        Record of the unit under test.
      </Property>
      <Property name="serial_number" type="string, required" indent>
        Unit identifier. Creates new unit if no match.
      </Property>
      <Property name="part_number" type="string, optional" indent>
        Component identifier. Creates new component if no match.
      </Property>
      <Property name="revision" type="string, optional" indent>
        Component revision. Required if multiple revisions exist.
      </Property>
      <Property name="run_passed" type="boolean, required">
        Indicates if the run passed.
      </Property>
      <Property name="duration" type="string, required">
        ISO 8601 duration of the run.
      </Property>
      <Property name="started_at" type="string">
        ISO 8601 start time of the run.
      </Property>
      <Property name="steps" type="array, optional">
        Steps of the procedure.
      </Property>
      <Property name="name" type="string, required" indent>
        Step name.
      </Property>
      <Property name="step_passed" type="boolean, required" indent>
        Indicates if the step passed.
      </Property>
      <Property name="started_at" type="string, required" indent>
        ISO 8601 start time of the step.
      </Property>
      <Property name="duration" type="string, required" indent>
        ISO 8601 duration of the step.
      </Property>
      <Property name="measurement_unit" type="string, optional" indent>
        Unit of measurement.
      </Property>
      <Property name="measurement_value" type="float, optional" indent>
        Measured value.
      </Property>
      <Property name="limit_low" type="float, optional" indent>
        Minimum threshold.
      </Property>
      <Property name="limit_high" type="float, optional" indent>
        Maximum threshold.
      </Property>
      <Property name="attachments" type="array(string), optional">
        File paths for attachments.
      </Property>
      <Property name="sub_units" type="array(record), optional">
        Identifiers of sub-units.
      </Property>
      <Property name="serial_number" type="string, required" indent>
        Serial number of sub-unit.
      </Property>
      <Property name="report_variables" type="record(string, string)">
        Key/value pairs for report variables.
      </Property>
    </Properties>
  </Col>
  <Col sticky>

    <CodeGroup title="Request" tag="POST" label="/v1/runs">

```python
from tofupilot import TofuPilotClient
import time
from datetime import datetime

def test_function():
    # Your test execution goes here
    time.sleep(1)

    run_passed = True
    report_variables = {
      "initial_temperature_reading": "72°C",
      "final_temperature_reading": "75°C",
    }
    attachments = [
      '/mnt/data/temperature-map.png',
      '/mnt/data/performance-report.pdf'
    ]

    return run_passed, report_variables, attachments

# Measure the duration of the test_function
start_time = datetime.now()
run_passed, report_variables, attachments = test_function()
end_time = datetime.now()
duration = end_time - start_time

client = TofuPilotClient(api_key="Your API key goes here")

client.create_run(
    procedure_id="FVT1",
    unit_under_test={
        "serial_number": '00102',
        "part_number": 'PCB01'
    },
    run_passed=run_passed,
    duration=duration,
    report_variables=report_variables,
    attachments=attachments
)
```

```bash {{ title: 'cURL' }}
curl -X POST https://www.tofupilot.com/api/v1/runs
  -H "Content-Type: application/json"
  -H "Authorization: Bearer {your_api_key}"
  -d '{
    "procedure_id": "FVT1",
    "unit_under_test": {
      "serial_number": "00102",
      "part_number": "PCB01"
    },
    "run_passed": true,
    "duration": "PT27M15S"
}'
```

```js
fetch('https://www.tofupilot.com/api/v1/runs', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: 'Bearer "your_api_key"',
  },
  body: JSON.stringify({
    procedure_id: 'FVT1',
    unit_under_test: {
      serial_number: '00102',
      part_number: 'PCB01',
    },
    run_passed: true,
    duration: 'PT27M15S',
  }),
})
```

    </CodeGroup>

    ```json {{ title: 'Response' }}
    {
      "url": "https://tofupilot.com/acme-corp/runs/your-new-run"
    }
    ```

  </Col>
</Row>

---

## Errors

Whenever a request is unsuccessful, the TofuPilot API will return a response with a status code and error message.

### Status Codes

Here are the categories of status codes returned by the TofuPilot API:

<Properties>
  <Property name="2xx">
    A 2xx status code indicates a successful response.
  </Property>
  <Property name="4xx">A 4xx status code indicates a client error.</Property>
  <Property name="5xx">A 5xx status code indicates a server error.</Property>
</Properties>

### Error Messages

Use error messages to identify and fix issues. For example:

```bash {{ title: "Error response" }}
{
  "status_code": 404,
  "message": "No procedure found with ID FVT2",
}
```
